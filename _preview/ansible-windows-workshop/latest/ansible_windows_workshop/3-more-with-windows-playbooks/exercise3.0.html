<!DOCTYPE html>
<!--[if IE 8]> <html class="ie8"> <![endif]-->
<!--[if IE 9]> <html class="ie9"> <![endif]-->
<!--[if gt IE 9]><!-->
<html>
<!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Ansible Windows Workshop latest | Ansible Windows Exercises | 3 - More with Playbooks | Exercise 3.0</title>
  <link href="https://assets.openshift.net/content/subdomain.css" rel="stylesheet" type="text/css">
  <link href="../../../latest/_stylesheets/docs.css" rel="stylesheet" />
  <link href="https://www.ansible.com/hs-fs/hub/330046/file-448313641-png/favicon.png" rel="apple-touch-icon-precomposed" type="image/png">
  <link href="https://www.ansible.com/hs-fs/hub/330046/file-448313641-png/favicon.png" rel="shortcut icon" type="text/css">
  <!--[if IE]><link rel="shortcut icon" href="https://www.ansible.com/hs-fs/hub/330046/file-448313641-png/favicon.png"><![endif]-->
  <!-- or, set /favicon.ico for IE10 win -->
  <meta content="OpenShift" name="application-name">
  <meta content="#000000" name="msapplication-TileColor">
  <meta content="https://www.ansible.com/hs-fs/hub/330046/file-448313641-png/favicon.png" name="msapplication-TileImage">
  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="https://assets.openshift.net/content/html5shiv.js" type="text/javascript"></script>
    <script src="https://assets.openshift.net/content/respond.js" type="text/javascript"></script>
    <link href="https://assets.openshift.net/content/vendor/respond-js/respond-proxy.html" id="respond-proxy" rel="respond-proxy">
    <link href="../../../latest/_images/respond.proxy.gif" id="respond-redirect" rel="respond-redirect">
    <script src="../../../latest/_javascripts/respond.proxy.js" type="text/javascript"></script>
  <![endif]-->
  <script src="https://assets.openshift.net/content/modernizr.js" type="text/javascript"></script>
  <script src="https://assets.openshift.net/content/subdomain.js" type="text/javascript"></script>
  <script src="../../../latest/_javascripts/bootstrap-offcanvas.js" type="text/javascript"></script>
  <script type="text/javascript" src="https://assets.openshift.net/app/assets/site/tracking.js"></script>
</head>
<body>
  <div class="navbar navbar-default navbar-openshift" role="navigation">
  <div class="navbar-header">
    <div class="dropdown">
      <a href="#" class="dropdown-toggle navbar-menu-toggle" data-toggle="dropdown">
        <span class="navbar-menu-title">MENU</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>
      <ul class="dropdown-menu navbar-menu" role="menu">
        <li class="submenu">
          <a href="#">Overview</a>
          <ul id="submenu-overview" class="dropdown-submenu">
            <li class="submenu-heading">Ansible Workshop</li>
            <li>
                What is Ansible Tower?
                <span class="submenu-item-desc">Extend the power of Ansible to your entire team. Ansible Tower by Red Hat helps you scale IT automation, manage complex deployments and speed productivity. Centralize and control your IT infrastructure with a visual dashboard, role-based access control, job scheduling and graphical inventory management.</span>
              </a>
            </li>
            <li class="submenu-heading">Links</li>
            <li>
              <a href="https://www.ansible.com/tower">
                Ansible Tower
                <span class="submenu-item-desc">Learn more about Ansible Tower.</span>
              </a>
            </li>
            <li>
              <a href="https://www.ansible.com/">
                Ansible
                <span class="submenu-item-desc">Ansible seamlessly unites workflow orchestration with configuration management, provisioning, and application deployment in one easy-to-use and deploy platform.</span>
              </a>
            </li>
            <li>
              <a href="https://galaxy.ansible.com/">
                Ansible Galaxy
                <span class="submenu-item-desc">Jump-start your automation project with great content from the Ansible community. Galaxy provides pre-packaged units of work known to Ansible as roles. Roles can be dropped into Ansible PlayBooks and immediately put to work. You'll find roles for provisioning infrastructure, deploying applications, and all of the tasks you do everyday.</span>
              </a>
            </li>
          </ul>
        </li>
        <li class="submenu">
          <a href="#">Connect</a>
          <ul id="submenu-connect" class="dropdown-submenu">
            <li>
              <a href="https://access.redhat.com/downloads/">
                Downloads <i class="fa fa-external-link pull-right"></i>
              </a>
            </li>
            <li>
              <a href="https://www.facebook.com/ansibleautomation/">
                Facebook <i class="fa fa-external-link pull-right"></i>
              </a>
            </li>
            <li>
              <a href="https://www.linkedin.com/company/red-hat">
                LinkedIn <i class="fa fa-external-link pull-right"></i>
              </a>
            </li>
            <li>
              <a href="https://plus.google.com/+RedHat">
                Google+ <i class="fa fa-external-link pull-right"></i>
              </a>
            </li>
            <li>
              <a href="https://www.youtube.com/user/RedHatVideos">
                YouTube <i class="fa fa-external-link pull-right"></i>
              </a>
            </li>
          </ul>
        </li>
      <li class="submenu">
        <a href="#">Contact Us</a>
        <ul id="submenu-connect" class="dropdown-submenu">
          <li>
             <a href="https://www.redhat.com/en/about/contact#na">
             Contact Us
             </a>
          </li>
        </ul>
    </div>
    <a class="navbar-brand red-hat-public-sector" href="/"></a>
  </div>
  <!-- <div class="navbar-collapse collapse">
    <ul class="nav navbar-nav navbar-right">
      <li class="hidden-xs dropdown"> <a href="#" class="dropdown-toggle nav-log-in" data-toggle="dropdown"> My Account<span class="caret"></span> </a>
        <ul class="dropdown-menu">
          <li><a href="https://openshift.redhat.com/app/console">OpenShift Web Console</a></li>
          <li><a href="https://console.preview.openshift.com/">(Next Gen) Web Console</a></li>
          <li><a href="https://hub.openshift.com/users/auth/github">OpenShift Hub</a></li>
        </ul>
      </li>
      <li class="hidden-xs hidden-sm"><a class="nav-sign-up" href="https://www.openshift.com/devpreview/register.html">Sign up for Free</a></li>
    </ul>
  </div> -->
</div>
  <div class="container">
    <p class="toggle-nav visible-xs pull-left">
      <button class="btn btn-default btn-sm" type="button" data-toggle="offcanvas">Toggle nav</button>
    </p>
    <ol class="breadcrumb">
      <li class="sitename">
        <a href="../../../index.html">Workshops</a>
      </li>
      <li class="hidden-xs active">
        Ansible Windows Workshop latest
      </li>
      <li class="hidden-xs active">
        Ansible Windows Exercises
      </li>
      <li class="hidden-xs active"><a href="../../ansible_windows_workshop/3-more-with-windows-playbooks/exercise3.0.html">3 - More with Playbooks</a></li>
      <li class="hidden-xs active">
        Exercise 3.0
      </li>
    </ol>
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas">
        <div class="row-fluid">
          
<script>
  (function() {
    var cx = '013769182564158614814:e-dp46b51vk';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>

        </div>
        <ul class="nav nav-sidebar">
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup0">
        <span id="tgSpan0" class="fa fa-angle-down"></span>Ansible Windows Exercises
      </a>
      <ul id="topicGroup0" class="collapse in list-unstyled">
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-0-0">
                <span id="sgSpan-0-0" class="fa fa-caret-right"></span>&nbsp;Welcome
              </a>
              <ul id="topicSubGroup-0-0" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../../ansible_windows_workshop/0-setup/index.html">Agenda</a></li>

                  <li><a class="" href="../../ansible_windows_workshop/0-setup/setup.html">Workshop Lab Setup</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-0-1">
                <span id="sgSpan-0-1" class="fa fa-caret-right"></span>&nbsp;1 - Essentials
              </a>
              <ul id="topicSubGroup-0-1" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../../ansible_windows_workshop/1-essentials/exercise1.0.html">Exercise 1.0</a></li>

                  <li><a class="" href="../../ansible_windows_workshop/1-essentials/exercise1.1.html">Exercise 1.1</a></li>

                  <li><a class="" href="../../ansible_windows_workshop/1-essentials/exercise1.2.html">Exercise 1.2</a></li>

                  <li><a class="" href="../../ansible_windows_workshop/1-essentials/exercise1.3.html">Exercise 1.3</a></li>

                  <li><a class="" href="../../ansible_windows_workshop/1-essentials/exercise1.4.html">Exercise 1.4</a></li>

                  <li><a class="" href="../../ansible_windows_workshop/1-essentials/exercise1.5.html">Exercise 1.5</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-0-2">
                <span id="sgSpan-0-2" class="fa fa-caret-right"></span>&nbsp;2 - Tower
              </a>
              <ul id="topicSubGroup-0-2" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../../ansible_windows_workshop/2-tower/exercise2.0.html">Exercise 2.0</a></li>

                  <li><a class="" href="../../ansible_windows_workshop/2-tower/exercise2.1.html">Exercise 2.1</a></li>

                  <li><a class="" href="../../ansible_windows_workshop/2-tower/exercise2.2.html">Exercise 2.2</a></li>

                  <li><a class="" href="../../ansible_windows_workshop/2-tower/exercise2.3.html">Exercise 2.3</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-0-3">
                <span id="sgSpan-0-3" class="fa fa-caret-down"></span>&nbsp;3 - More with Playbooks
              </a>
              <ul id="topicSubGroup-0-3" class="nav-tertiary list-unstyled collapse in">

                  <li><a class=" active" href="../../ansible_windows_workshop/3-more-with-windows-playbooks/exercise3.0.html">Exercise 3.0</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-0-4">
                <span id="sgSpan-0-4" class="fa fa-caret-right"></span>&nbsp;Wrap Up
              </a>
              <ul id="topicSubGroup-0-4" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../../ansible_windows_workshop/0-setup/wrapup.html">Wrap-up</a></li>
              </ul>
            </li>
      </ul>
    </li>
</ul>
      </div>
      <div class="col-xs-12 col-sm-9 col-md-9 main">
        <div class="page-header">
          <h2>Exercise 3.0 - Windows Patching with Ansible</h2>
        </div>
        <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Patching windows systems can be a very time consuming task, but working with ansible you could reduce this time significantly.</p>
</div>
<div class="paragraph">
<p>In this exercise, you will update your windows nodes.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-a-new-playbook"><a class="anchor" href="#creating-a-new-playbook"></a>Creating a new Playbook</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="step-1"><a class="anchor" href="#step-1"></a>Step 1:</h3>
<div class="paragraph">
<p>Within Visual Studio Code, create a new directory in your git repo and create a site.yml file.</p>
</div>
<div class="paragraph">
<p>In the Explorer accordion you should have a 'student#-playbooks' section.</p>
</div>
<div class="paragraph">
<p>Create a folder called <strong>windows_patching</strong> and a file called <strong>patch_windows.yml</strong>.</p>
</div>
<div class="paragraph">
<p>Hover over the <strong>student#-playbooks</strong> section and click the <strong>New Folder</strong> button.</p>
</div>
<div class="paragraph">
<p>Type <strong>windows_patching</strong> and press enter.  Then click that folder so it is selected.</p>
</div>
<div class="paragraph">
<p>Hover over the <strong>student#-playbooks</strong> section again and click the <strong>New File</strong> button.</p>
</div>
<div class="paragraph">
<p>Type <strong>patch_windows.yml</strong> and press enter.</p>
</div>
<div class="paragraph">
<p>You should now have an editor open in the right pane that can be used for creating your playbook.</p>
</div>
</div>
<div class="sect2">
<h3 id="step-2"><a class="anchor" href="#step-2"></a>Step 2:</h3>
<div class="paragraph">
<p>Add a play to your playbook.  These include defining serial parameter which executes the playbook in stages to it doesn&#8217;t try patch all systems all at once.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">---
- hosts: windows
  serial:
   - 25%
  max_fail_percentage: 25%
  vars:
    win_updates_categories:
      - CriticalUpdates
      - SecurityUpdates
  tasks:
  - name: Check for missing updates
    win_updates:
      state: searched
      category_names: &quot;{{ win_updates_categories }}&quot;
    register: search_updates

  - name: Show missing updates
    debug:
      var: search_updates

  - name: Install missing updates.
    win_updates:
      category_names: &quot;{{ win_updates_categories }}&quot;
    register: apply_updates

  - name: Reboot if needed
    win_reboot:
    when: apply_updates.reboot_required</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="step-3-commit-and-review"><a class="anchor" href="#step-3-commit-and-review"></a>Step 3: Commit and Review</h3>
<div class="paragraph">
<p>Your new, improved playbook is done! But remember we still need to commit the changes to source code control.</p>
</div>
<div class="paragraph">
<p>Click <strong>File &#8594; Save All</strong> to save the files you&#8217;ve written</p>
</div>
<div class="paragraph">
<p>Click on the Source Code icon, type in a commit message such as <strong>Adding basic playbook</strong>, and click the check box above.</p>
</div>
<div class="paragraph">
<p>Sync to gitlab by clicking the arrows on the lower left blue bar.  When prompted, click <strong>OK</strong> to push and pull commits.</p>
</div>
<div class="paragraph">
<p>It should take 20-30 seconds to finish the commit.  The blue bar should stop rotating and indicate 0 problems&#8230;&#8203;</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-your-playbook-from-tower"><a class="anchor" href="#running-your-playbook-from-tower"></a>Running your playbook from Tower</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="step-1-2"><a class="anchor" href="#step-1-2"></a>Step 1:</h3>
<div class="paragraph">
<p>Create a new job template in tower and add patch_windows playbook.</p>
</div>
</div>
<div class="sect2">
<h3 id="step-2-2"><a class="anchor" href="#step-2-2"></a>Step 2:</h3>
<div class="paragraph">
<p>Run the playbook from Tower and review the results.</p>
</div>
</div>
<div class="sect2">
<h3 id="end-result"><a class="anchor" href="#end-result"></a>End Result</h3>
<div class="paragraph">
<p>After running the playbook from Tower, it will update your nodes with the latest patches.</p>
</div>
</div>
</div>
</div>
      </div>
    </div>
  </div>
  <script type="text/javascript">
    /*<![CDATA[*/
    $(document).ready(function() {
      $("[id^='topicGroup']").on('show.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicGroup']").on('hide.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicSubGroup']").on('show.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
      $("[id^='topicSubGroup']").on('hide.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
    });
    /*]]>*/
  </script>
    <footer class="footer-openshift">
  <div class="container">
    <div class="row">
      <div class="col-xs-12 col-sm-4 col-md-3 logo">
        <a href="https://www.redhat.com/"></a>
      </div>
      <div class="col-xs-12 col-sm-4 col-md-6 text-center">
        <div class="row">
          <div class="col-xs-12 col-md-4">
            <a href="https://www.redhat.com/en/about/privacy-policy">
              Privacy Policy
            </a>
          </div>
          <div class="col-xs-12 col-md-4">
          <a href="https://www.redhat.com/en/about/terms-use">
            Terms and Conditions
          </a>
          </div>
        </div>
      </div>
      <div class="col-xs-12 col-sm-4 col-md-3 text-right">
        <a id="built_with_asciibinder" href="http://asciibinder.org/">
          <img src="../../../latest/_images/asciibinder_web_logo.svg" alt="AsciiBinder" />
        </a>
      </div>
    </div>
  </div>
</footer>
</body>
</html>